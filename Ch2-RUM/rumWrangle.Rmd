
```{r libraries, include = FALSE}
library(tidyverse)
library(lubridate)
```

# Data Wrangling {.tabset} 

# Merging Data 
After downloading the data from arcCollector, you end up three individual .csv docs for each survey layer; meta_21.csv, use_21.csv, avidity_21.csv (this includes data from 2020 field trip to). Merge the three sets of data, linking them by their GlobalID and GUID. 

1. Read in documents
2. Merge meta.csv and use.csv to make MetaUse.csv 
3. Merge MetaUse.csv and avidity.csv to make Ning0421

```{r  readData and Merge}
meta <- read.csv("rumIgnore/Data-042021/meta_21.csv")
use <- read.csv("rumIgnore/Data-042021/use_21.csv")
avidity <- read.csv("rumIgnore/Data-042021/avidity_21.csv")
jon <- read.csv("rumIgnore/Data-jon/ALL3TRIPSMASTERDATASETFEB22.csv")

is.data.frame(meta) # checking object is df -> TRUE
is.data.frame(use) # checking object is df -> TRUE
is.data.frame(avidity) # checking object is df -> TRUE
is.data.frame(jon)

MetaUse<- merge(meta, use, by.x = "GlobalID", 
                by.y = "Guid", all.x = TRUE, all.y = TRUE) # merge Meta.csv (x) and Use.csv (y) dfs by GlobalID and GUID column
Ning0421 <- merge(MetaUse, avidity, by.x = "GlobalID.y", 
                   by.y = "Guid", all.x = TRUE, all.y = TRUE) # merge MetaUse0421.csv (x) and Avidity.csv (y) dfs by GlobalUse and GUIDavid column

write.csv(Ning0421, 'rumIgnore/Ning0421.csv') # save merged df as .csv, Path specified for rumIgnore folder.
```

```{r clean, eval = FALSE}
tbl_df(jon)
glimpse(jon)
tbl_df(Ning0421) # converting to tibble 
glimpse(Ning0421) # kind of like str for tibble 

Ning <- bind_rows(Ning0421, jon) %>% # Adding on Jons data
  select(-c(GlobalID.y, GlobalID.x, GlobalID.y.y, Guid, OBJECTID.x, OBJECTID.y, OBJECTID,
            Creator.x, Creator.y, Creator, EditDate.x, EditDate.y, EditDate, Editor.x, Editor.y,
            Editor, CreationDate.y, CreationDate)) %>% 
  
# The above variables have been deselected because they are unnecessary, ID vars will be replaced with a new ID col, Creator and Editor is always Harrison, only date variable I need is date which was inputted by interviewer and CreationDate.x incase it has been missed
  
  select(-c(Boat_ramp_location, Interviewer_name, Day_type,Competition_noncompetition, 
            Number_boats_interviewed_that_day,What_time_did_lines_enter_the_water, 
            What_time_did_lines_leave_the_water, What_fishing_method_was_used, 
            What_type_of_bait_or_lure_was_used, Was_berleying_used, 
            What_was_the_maximum_depth_of_hooks, What_was_the_minimum_depth_of_hooks,
            Why_did_you_choose_to_fish_at_that_site, 
            How_many_fish_did_you_catch_including_those_kept_and_those_returned,
            What_species_of_fish_did_you_catch, Did_you_experience_shark_bite_offs,
            If_yes_how_many_fish_did_you_lose, 
            Were_these_fish_lost_completely_or_was_part_of_the_fish_.e.g.head._retrieved,
            Boat_name_or_number, Boat_length, Time_of_interview, 
            Full_completion_or_partial_or_refusal, If_partial_or_refusal_why,
            Comments, Have_you_been_interviewed_about_shark_bite_offs_before,
            How_many_times_have_you_fished_from_this_boat_ramp_before,
            How_many_days_have_you_fished_from_a_boat_this_year,
            How_many_years_have_you_been_fishing_for,
            Home_postcode, What_is_your_income_before_tax, How_many_sharks_were_hooked,
            If_you_suffered_depredation_what_was_the_cost_of_the_gear_that_you_lost_today)) %>% # These is Canarvan Q's
  
  select(-c("Day.number", "Trip.number", "Lat.bins", "X5nm.grid..block.code", "Maidenhead..Grid.Square",
            "Cost.of.gear.lost.to.depredation....", "Burley.used..Y.N", "Min.hook..depth", "Have_you_been_interviewed_about",
            "How.many.times.fished.from.this.boat.ramp.categorical..1...0.25.times..2...26.50..3...51.75..4...76.100..5.....100.",
            )) %>%

  # format: rename(newname = currentname)
  rename(Interviewer = "REQUIRED..Interviewer",
         Transect = "REQUIRED..Boat.ramp.transect.name",
         Screen1 = "SCREEN..18.", 
         Screen2 = "SCREEN..have.we.interviewed.you.in.the.last.2.weeks.", 
         Agreement = "REQUIRED..Agreement.to.Participate",
         nDaysInArea = "How.many.days.are.you.in.the.area.",
         nDaysInArea_other = "If.OTHER....days.in.area",
         BoatAccess = "Do.you.have.access.to.a.private.boat.while.your.here.",
         nBoatDays = "If.YES....days.you.intend.to.spend.on.boat.",
         nBoatDays_other = "If.OTHER....days.on.private.boat.",
         nShoreDays = "X..days.you.intend.to.be.engaged.in.shore.based.activities.",
         nShoreDays_other = "If.OTHER....days.on.shore.",
         nTimesLast12m = "X..separate.times.in.area.in.last.12.months.",
         nTimesLast12m_other = "If.OTHER....times.in.last.12.months",
         nTimes19 = "X..separate.times.in.area.in.2019.",
         nTimes19_other = "If.OTHER....times.in.area.in.2019",
         Covid = "Would.you.be.elsewhere.if.it.weren.t.for.travel.restrictions.",
         SurveyLong = "x.x",
         SurveyLat = "y.x",
         EXTRACTIVE = "EXTRACTIVE.SURVEY",
         exRecall = "If.RECALL..date",
         FishingType = "What.type.of.fishing.did.you.do.at.this.site.",
         FishingType_other = "If.OTHER..fishing.type",
         BaitLure = "Did.you.use.a.bait.or.lure.",
         exStart = "What.time.did.you..if.spearfishing...your.lines.get.in.the.water.",
         exStop = "What.time.did.you..if.spearfishing..your.lines.get.out.the.water..",
         MaxHook = "Max.depth.of.hook.at.this.site.",
         KeptUndam = "X..fish.you.kept.undamaged.at.this.site.",
         KeptUdam_other = "If.OTHER....kept.undamaged",
         RelUndam = "X..released.undamaged.at.this.site.",
         RelUndam_other = "If.OTHER....released.undamaged",
         nDP = "X..depredated",
         nDP_other = "If.OTHER....depredated",
         Species = "What.species.did.you.catch.",
         exWhyLeave = "Why.did.you.leave.this.site.",
         exWhyLeave_other = "If.OTHER..why.did.you.leave.this.site.",
         NONEXTRACTIVE = "NON_EXTRACTIVE.SURVEY",
         nexRecall = "If.RECALL..date.1",
         Activity = "What.activity.did.you.do.",
         Activity_other = "If.OTHER..activity",
         nexStart = "What.time.did.you.start.the.activity.",
         nexStop = "What.time.did.you.end.the.activity.",
         DiveMaxDepth = "If.DIVING..max.depth.",
         WhyChoose = "Why.did.you.choose.this.site.",
         WhyChoose_other = "If.OTHER..why.this.site",
         nexWhyLeave = "Why.did.you.leave.this.site..1",
         nexWhyLeave_other = "If.OTHER..why.did.you.leave.this.site..1",
         UseLong = "x.y",
         UseLat = "y.y",
         exnTimes12m = "X..times.fished.from.boat.in.last.12.months.",
         nexnTimes12m = "X..times.doing.NEX.last.12.months..",
         exYrs = "X..years.fishing.",
         nexYrs = "X..years.doing.NEX.",
         DiveCert = "Are.you.a.diver..If.so..what.is.your.certification.",
         nDives = "If.DIVING....dives.",
         YrBorn = "What.year.were.you.born.",
         Postcode = "Home.postcode",
         Accom = "If.VISITOR..where.are.you.staying.",
         Accom_other = "If.OTHER..where.are.you.staying",
         Sex = "Male.or.Female",
         Party = "Describe.party",
         BoatLength = "Boat.length",
         BoatType = "Boat.Type",
         BoatID = "Boat.name.or.number",
         JulianDay = "Julian.day",
         BR = "Boat.ramp",
         BRLat = "Boat.ramp.lat",
         BRLong = "Boat.ramp.long",
         nBoatsFishThatDay = "No..boats.fishing.that.day",
         jUseLat = "Lat",
         jUseLong = "Long",
         KernDens = "Kernel.density",
         SST = "SST..NOAA.data.",
         DistBRm = "Distance.of..fishing.location..from.boat.ramp..miles.",
         DistBRnm = "Distance.of..fishing.location..from.boat.ramp..nautical.miles.",
         DistBRkm = "Distance.of..fishing.location..from.boat.ramp..km.",
         jCaughtUndam = "No..fish.caught.undamaged",
         jnDP = "No..fish.lost.to.sharks",
         nHooked = "Total.fish.hooked",
         perDP = "Percentage.depredation",
         proDP = "Proportional.depredation...between.0.1.",
         binDP = "Binary.depredation.presence.absence",
         nUndamHr = "No..fish.caught..undamaged.per.hour",
         nDPHr = "No..fish.lost.per.hour",
         nHookedHr = "Total.fish.hooked.per.hour",
         DPRateHr = "Depredation.rate.....per.hour",
         jexStart = "Time.lines.in",
         jexStop = "Time.lines.out",
         MedianTime = "Median.time",
         DecMedianTime = "Decimal.Median.time",
         FishingHr = "Fishing.hours",
         DecFishingHr = "Decimal.fishing.hours",
         FishTime = "Fishing.time..rounded.to.nearest.whole.number",
         jFishingType = "Fishing.method",
         jBaitLure = "Bait.type",
         jMaxHook = "Max.hook..depth",
         jBoatID = "Boat.name.number",
         jBoatLength = "Boat.Length",
         jTime = "Time.of..interview",
         nTimesFished = "How_many_times_have_you_fished_",
         jexYrs = "How_many_years_have_you_been_fi",
         jDaysBoatFished = "How_many_days_have_you_boat._fished_f",
         jDaysBoatFishedCat = "How.many.days.have.you.boat.fished.in.the.last.year.categorical..1...0.25..2...26.50..3...51...75..4...76...100..5.") %>%
  
  mutate(Date = ifelse(Date %in% "", CreationDate.x, Date)) %>% # Filling blanks in Date col with values from CreationDate.x 
  select(-c(CreationDate.x)) # Removing creation date col
  
names(Ning)
```


